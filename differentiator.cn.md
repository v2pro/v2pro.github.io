* TOC
{:toc}

# 总体思路

没有必要重新造重复的轮子，那是在浪费生命。

* 基础组件：大部分轮子都要把用户绑死在一个实现上。我们需要一个中间层，通过 interface 提供 API 给直接用户，提供 SPI 做为扩展点给其他的库作者。让业务和具体的轮子解耦，使得业务逻辑可以方便迁移。通过 SPI 让轮子之间的互相组合成为可能。
* 业务平台：在线业务的微服务可以分成“存储”，“流程”和“智能”三类。提供平台使得三类微服务共性的部分可以下沉，使得写业务的同学可以专注于业务逻辑本身。
* 进程外流量监控和回放：对于遗留应用，改代码的成本是非常高的。通过在网络层分析流量，可以快速给遗留应用提供质量保证手段。

# 基础组件

## 反射

### Accessor

把对象分为以下几类：

* 简单值
* Struct
* Map
* Array
* Variant

提供抽象的反射接口对这些对象进行读和写。这些对象底层可以是

* go 语言的对象
* http request/response
* json []byte
* thrift []byte
* mysql protocol []byte
* redis protocol []byte

Accessor提供的能力可分为（类似 STL 的 iterator）：

* 顺序读
* 随机读
* 顺序写
* 随机写

# 业务平台

# 进程外流量监控和回放
